<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" type="image/png" href="../img/ryicon.jpg">
  <title>BookStore - Thêm phiếu nhập</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <link href="assets/css/pure-style-optimized.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">


  <style>
    /* ===== POPUP STYLE ===== */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .popup-content {
      background: #fff;
      padding: 2rem;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      animation: fadeIn 0.3s ease;
      width: 320px;
    }

    .popup-icon {
      font-size: 48px;
      color: #4CAF50;
      margin-bottom: 1rem;
    }

    .popup-content h2 {
      margin-bottom: 0.5rem;
      color: #333;
    }

    .popup-content p {
      color: #555;
      margin-bottom: 1.5rem;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .ingredient-table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .ingredient-table thead {
      background: linear-gradient(195deg, #2b2825, #2b2825);
      color: #fff;
    }

    .ingredient-table th,
    .ingredient-table td {
      padding: 12px 16px;
      text-align: center;
      font-size: 14px;
      vertical-align: middle;
    }

    .ingredient-table tbody tr:nth-child(even) {
      background-color: #fafafa;
    }

    .ingredient-table tbody tr:hover {
      background-color: #f2f2f2;
      transition: background-color 0.2s;
    }

    /* ====== Nút hành động "+" ====== */
    .btn-action {
      background-color: #ff9800;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      width: 28px;
      height: 28px;
      line-height: 28px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .btn-add{
      background-color: #ff9800;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      width: 28px;
      height: 28px;
      line-height: 28px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-action:hover {
      background: linear-gradient(195deg, #ffa726, #fb8c00);
      transform: translateY(-1px);
      box-shadow: 0 3px 6px rgba(255, 152, 0, 0.3);
    }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f0f2f5;
      color: #344767;
      line-height: 1.6;
      overflow-x: hidden;
    }

    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      margin-bottom: 1.5rem;
      overflow: hidden;
    }

    .card-header {
      background: linear-gradient(195deg, #202021, #202021);
      color: white;
      padding: 1rem 1.5rem;
    }

    .card-body {
      padding: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #344767;
    }

    .form-control {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #d2d6da;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .form-control:focus {
      border-color: #e91e63;
      box-shadow: 0 0 0 2px rgba(233, 30, 99, 0.2);
      outline: none;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      margin: 0 -0.5rem;
    }

    .form-col {
      flex: 1;
      padding: 0 0.5rem;
      min-width: 200px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 0.75rem 1.5rem;
      border-radius: 6px;
      border: none;
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }

    .btn-primary {
      background: #FF9800;
    }

    .btn-primary:hover {
      background: #FF9800;
    }

    .btn-secondary {
      background: #FF9800;
    }

    .btn-secondary:hover {
      background: #FF9800;
    }

    .btn-success {
      background: #28a745;
    }

    .btn-success:hover {
      background: #218838;
    }

    .btn-danger {
      background: #dc3545;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 1.5rem;
    }

    .product-row {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 0.5rem;
      align-items: center;
    }

    .product-select {
      flex: 2;
    }

    .product-price {
      flex: 1;
    }

    .product-quantity {
      flex: 1;
    }

    .product-total {
      flex: 1;
      font-weight: 600;
      color: #e91e63;
    }

    .product-actions {
      flex: 0.5;
      display: flex;
      justify-content: center;
    }

    .material-icons-round {
      font-size: 18px;
      vertical-align: middle;
    }

    .summary-card {
      background: #f8f9fa;
      border-radius: 0.5rem;
      padding: 1rem;
      margin-top: 1.5rem;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
      border-bottom: 1px solid #dee2e6;
    }

    .summary-total {
      font-weight: 700;
      font-size: 1.2rem;
      color: #e91e63;
    }

    /* Custom select with product info */
    .custom-select {
      position: relative;
      width: 100%;
    }

    .custom-select select {
      display: none;
    }

    .select-selected {
      background-color: white;
      border: 1px solid #d2d6da;
      border-radius: 0.5rem;
      padding: 0.75rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .select-selected:after {
      position: absolute;
      content: "";
      top: 50%;
      right: 15px;
      width: 0;
      height: 0;
      border: 6px solid transparent;
      border-color: #344767 transparent transparent transparent;
      transform: translateY(-50%);
    }

    .select-selected.select-arrow-active:after {
      border-color: transparent transparent #344767 transparent;
      top: 40%;
    }

    .select-items {
      position: absolute;
      background-color: white;
      top: 100%;
      left: 0;
      right: 0;
      z-index: 99;
      border: 1px solid #d2d6da;
      border-radius: 0.5rem;
      max-height: 300px;
      overflow-y: auto;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .select-items div {
      padding: 0.75rem;
      cursor: pointer;
      border-bottom: 1px solid #f0f2f5;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .select-items div:hover {
      background-color: #f8f9fa;
    }

    .select-hide {
      display: none;
    }

    .product-option {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .product-image {
      width: 40px;
      height: 50px;
      object-fit: cover;
      border-radius: 4px;
      flex-shrink: 0;
    }

    .product-info {
      flex: 1;
    }

    .product-name {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .product-author {
      font-size: 0.8rem;
      color: #6c757d;
    }

    @media (max-width: 768px) {
      .form-col {
        flex: 100%;
        margin-bottom: 1rem;
      }

      .product-row {
        flex-direction: column;
        align-items: stretch;
      }

      .form-actions {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
        margin-bottom: 0.5rem;
      }
    }

    thead {
      background: linear-gradient(195deg, #2b2825, #2b2825);
      color: white;
    }
  </style>
</head>

<body>
  <!-- SIDEBAR -->
  <aside style="
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1000;
        width: 250px;
        height: 100vh;
        background: linear-gradient(195deg, #202021, #202021);
        color: white;
        box-shadow: 0 0 2rem rgba(0, 0, 0, 0.15);
      ">
    <div style="padding: 1.5em 1rem">
      <a href="#" style="
            display: flex;
            align-items: center;
            font-weight: 700;
            color: white;
            text-decoration: none;
          ">
        <span>CAKEZONE ADMIN</span>
      </a>
    </div>
    <hr style="border-top: 1px solid rgba(255, 255, 255, 0.1); margin: 1rem 0" />
    <ul style="list-style: none; padding: 0; margin: 0">
      <li>
        <a href="index.html" style="
              display: flex;
              align-items: center;
              padding: 0.75rem 1rem;
              color: white;
              text-decoration: none;
              
            "><i class="material-icons" style="margin-right: 10px"></i>Tổng
          quan</a>
      </li>
      <li>
        <a href="user.html" style="
              display: flex;
              align-items: center;
              padding: 0.75rem 1rem;
              color: white;
              text-decoration: none;
            "><i class="material-icons" style="margin-right: 10px"></i>Quản
          lý khách hàng</a>
      </li>
      <li>
        <a href="chef.html" style="
              display: flex;
              align-items: center;
              padding: 0.75rem 1rem;
              color: white;
              text-decoration: none;
            "><i class="material-icons" style="margin-right: 10px"></i>Quản
          lý đầu bếp</a>
      </li>
      <li>
        <a href="products.html" style="
              display: flex;
              align-items: center;
              padding: 0.75rem 1rem;
              color: white;
              text-decoration: none;
            "><i class="material-icons" style="margin-right: 10px"></i>Quản lý sản phẩm</a>
      </li>
      <li>
        <a href="order.html" style="
              display: flex;
              align-items: center;
              padding: 0.75rem 1rem;
              color: white;
              text-decoration: none;
            "><i class="material-icons" style="margin-right: 10px"></i>Quản lý đơn hàng</a>
      </li>

      <li>
        <a href="category.html" style="
              display: flex;
              align-items: center;
              padding: 0.75rem 1rem;
              color: white;
              text-decoration: none;
            "><i class="material-icons" style="margin-right: 10px"></i>Quản lý danh mục</a>
      </li>
      <li>
        <a href="import.html" style="
              display: flex;
              align-items: center;
              padding: 0.75rem 1rem;
              color: white;
              text-decoration: none;
              background: linear-gradient(195deg, #e88f2a, #e88f2a);
              box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2),
            0 7px 10px -5px rgba(240, 163, 74, 0.6);
            "><i class="material-icons" style="margin-right: 10px"></i>Quản lý nhập hàng</a>
      </li>

      <li>
        <a href="nguyenlieu.html" style="
              display: flex;
              align-items: center;
              padding: 0.75rem 1rem;
              color: white;
              text-decoration: none;
            "><i class="material-icons" style="margin-right: 10px"></i>Quản lý tồn kho</a>
      </li>

      <!-- Đăng xuất -->
      <li style="text-align:left;">
        <a href="../index.html" class="logout-btn">
          <i class="material-icons">logout</i><span>Đăng xuất</span>
        </a>
      </li>
    </ul>
  </aside>

  <!-- MAIN -->
  <main style="margin-left: 250px; min-height: 100vh; padding: 1.5rem;">
    <h1 style="margin-bottom: 1rem;">Tạo phiếu nhập</h1>

    <style>
      .import-container {
        display: flex;
        gap: 1.5rem;
        flex-wrap: wrap;
      }

      .left-panel,
      .right-panel {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 1rem;
        flex: 1;
        min-width: 380px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }

      .section-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: #333;
      }

      .search-box input {
        border-radius: 6px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
      }

      th,
      td {
        padding: 0.75rem;
        text-align: center;
        border-bottom: 1px solid #e5e5e5;
      }


      td img {
        width: 40px;
        height: 40px;
        border-radius: 4px;
        object-fit: cover;
      }

      .btn-action {
        padding: 0.25rem 0.75rem;
        font-size: 0.9rem;
      }

      .form-control {
        border-radius: 6px;
      }

      .order-summary {
        margin-top: 1rem;
        border-top: 1px solid #eee;
        padding-top: 1rem;
        font-size: 0.95rem;
      }

      .order-summary div {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
      }

      .btn-group {
        display: flex;
        justify-content: flex-end;
        gap: 0.5rem;
        margin-top: 1rem;
      }
    </style>

    <div class="import-container">
      <!-- LEFT PANEL -->
      <div class="left-panel">
        <div class="section-title">Tìm kiếm</div>
        <div class="search-box mb-3">
          <div class="input-group" style="display: flex; align-items: center;">
            <input type="text" class="form-control" placeholder="Tìm kiếm nguyên liệu..." style="max-width: 45%;">
            <button class="btn btn-primary" type="button" style="margin-left: 6px;">
              <i class="bi bi-search"></i> Tìm kiếm
            </button>
            <button class="btn btn-secondary" type="button" style="margin-left: 6px;">
              <i class="bi bi-arrow-repeat"></i> Làm mới
            </button>
          </div>
        </div>

        <br><br>
        <div class="">Danh sách nguyên liệu</div>
        <table class="ingredient-table">
          <thead>
            <tr>
              <th>Nguyên liệu</th>
              <th>Số lượng</th>
              <th>Giá</th>
              <th>Thêm</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Bột mì</td>
              <td>50 gói</td>
              <td>120.000đ</td>
              <td><button class="btn-add">+</button></td>
            </tr>
            <tr>
              <td>Đường nâu</td>
              <td>50 gói</td>
              <td>95.000đ</td>
              <td><button class="btn-add">+</button></td>
            </tr>
            <tr>
              <td>Bột cacao</td>
              <td>100 gói</td>
              <td>150.000đ</td>
              <td><button class="btn-add">+</button></td>
            </tr>
          </tbody>
        </table>
      </div>



      <!-- RIGHT PANEL -->
      <div class="right-panel">
        <div class="section-title">Thông tin</div>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Mã phiếu nhập</label>
            <input type="text" class="form-control" value="#PN004" readonly>
          </div>
          <div class="col-md-6">
            <label class="form-label">Mã nhân viên</label>
            <input type="text" class="form-control" value="NV001">
          </div>

          <div class="col-md-6">
            <label class="form-label">Mã nhà cung cấp</label>
            <input type="text" class="form-control" value="NCC003">
          </div>
          <div class="col-md-12">
            <label class="form-label">Note</label>
            <textarea class="form-control" rows="3" placeholder="Ghi chú thêm..."></textarea>
          </div>
        </div>

        <div class="section-title mt-4"></div>
        <table>
          <thead>
            <tr>
              <th>Nguyên liệu</th>
              <th>Số lượng</th>
              <th>Giá</th>
              <th>Tổng</th>
              <th>Xóa</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Đường nâu</td>
              <td><input type="number" value="10" min="1" class="form-control form-control-sm"
                  style="width: 70px; margin: auto;"></td>
              <td>95.000đ</td>
              <td>190.000đ</td>
              <td><button class="btn btn-sm btn-outline-danger btn-action">x</button></td>
            </tr>
          </tbody>
        </table>

        <div class="order-summary">
          <div><span>Tổng sản phẩm:</span><span>1</span></div>
          <div><span>Tổng số lượng:</span><span>2</span></div>
          <div><span>Tổng giá trị:</span><strong>190.000đ</strong></div>
        </div>

        <div class="btn-group">
          <button class="btn btn-primary">Xóa</button>
          <button id="save-import" class="btn btn-primary">Tạo phiếu nhập</button>
        </div>
      </div>
    </div>
  </main>

  <!-- POPUP THÀNH CÔNG -->
  <div id="successPopup" class="popup-overlay">
    <div class="popup-content">
      <div class="popup-icon">✅</div>
      <h2>Thành công!</h2>
      <p>Phiếu nhập đã được tạo thành công.</p>
      <button id="closePopupBtn" class="btn btn-primary">Đóng</button>
    </div>
  </div>

 <script>
  // ---------------------------
  // HÀM ĐỊNH DẠNG TIỀN
  // ---------------------------
  function formatCurrency(num) {
    return num.toLocaleString('vi-VN') + 'đ';
  }

  // ---------------------------
  // HÀM CẬP NHẬT TỔNG
  // ---------------------------
  function updateTotals() {
    const rows = document.querySelectorAll('.right-panel tbody tr');
    let totalItems = 0, totalQty = 0, totalPrice = 0;

    rows.forEach(row => {
      totalItems++;
      const qtyInput = row.querySelector('input[type="number"]');
      const qty = parseFloat(qtyInput.value) || 0;
      const price = parseInt(row.getAttribute('data-price')) || 0;
      const rowTotal = qty * price;

      // Cập nhật ô tổng
      row.querySelector('.total').textContent = formatCurrency(rowTotal);

      totalQty += qty;
      totalPrice += rowTotal;
    });

    // Cập nhật tóm tắt
    document.querySelector('.order-summary div:nth-child(1) span:last-child').textContent = totalItems;
    document.querySelector('.order-summary div:nth-child(2) span:last-child').textContent = totalQty;
    document.querySelector('.order-summary div:nth-child(3) strong').textContent = formatCurrency(totalPrice);
  }

  // ---------------------------
  // XỬ LÝ THÊM NGUYÊN LIỆU
  // ---------------------------
  document.querySelector('.left-panel').addEventListener('click', e => {
    const btn = e.target.closest('.btn-add');
    if (!btn) return;

    const row = btn.closest('tr');
    const name = row.children[0].innerText.trim();
    const price = parseInt(row.children[2].innerText.replace(/[^\d]/g, '')) || 0;

    const rightTbody = document.querySelector('.right-panel tbody');
    const existing = Array.from(rightTbody.querySelectorAll('tr'))
      .find(r => r.children[0].innerText.trim() === name);

    if (existing) {
      const qtyInput = existing.querySelector('input[type="number"]');
      qtyInput.value = parseFloat(qtyInput.value) + 1;
      updateTotals();
      return;
    }

    const newRow = document.createElement('tr');
    newRow.setAttribute('data-price', price);
    newRow.innerHTML = `
      <td>${name}</td>
      <td><input type="number" min="0.1" step="0.1" value="1" class="form-control form-control-sm" style="width: 70px; margin: auto;"></td>
      <td>${formatCurrency(price)}</td>
      <td class="total">${formatCurrency(price)}</td>
      <td><button class="btn btn-sm btn-outline-danger btn-action">x</button></td>
    `;
    rightTbody.appendChild(newRow);
    updateTotals();
  });

  // ---------------------------
  // XỬ LÝ XÓA / NHẬP SỐ LƯỢNG TRONG BẢNG PHẢI
  // ---------------------------
  const rightPanel = document.querySelector('.right-panel tbody');

  rightPanel.addEventListener('click', e => {
    const btn = e.target.closest('.btn-action');
    if (btn) {
      btn.closest('tr').remove();
      updateTotals();
    }
  });

  rightPanel.addEventListener('input', e => {
    if (e.target.matches('input[type="number"]')) {
      const input = e.target;
      if (parseFloat(input.value) < 0.1) input.value = 0.1;
      updateTotals();
    }
  });

  // ---------------------------
  // NÚT "TẠO PHIẾU NHẬP"
  // ---------------------------
  document.getElementById('save-import').addEventListener('click', () => {
    const rows = document.querySelectorAll('.right-panel tbody tr');
    if (rows.length === 0) {
      alert("Vui lòng thêm ít nhất một nguyên liệu trước khi tạo phiếu nhập!");
      return;
    }

    const products = Array.from(rows).map(row => ({
      name: row.children[0].textContent.trim(),
      quantity: parseFloat(row.querySelector('input').value),
      price: parseInt(row.getAttribute('data-price')),
      total: row.querySelector('.total').textContent
    }));
    console.log("Dữ liệu phiếu nhập:", products);

    const popup = document.getElementById("successPopup");
    popup.style.display = "flex";

    document.getElementById("closePopupBtn").onclick = () => {
      popup.style.display = "none";
      window.location.href = "import.html";
    };

    setTimeout(() => {
      popup.style.display = "none";
      window.location.href = "import.html";
    }, 2000);
  });

  // ---------------------------
  // KHỞI TẠO KHI LOAD
  // ---------------------------
  document.querySelectorAll('.right-panel tbody tr').forEach(row => {
    const priceText = row.children[2].innerText.replace(/[^\d]/g, '');
    row.setAttribute('data-price', priceText);
  });
  updateTotals();
</script>

</body>

</html>